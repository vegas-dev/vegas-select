// @vegas-VGSelect v1.1.0
!function(e,t){"object"==typeof exports&&"undefined"!=typeof module?t(exports):"function"==typeof define&&define.amd?define(["exports"],t):t((e="undefined"!=typeof globalThis?globalThis:e||self).window=e.window||{})}(this,(function(e){"use strict";const t={hide:function(e){e.style.display="none"},show:function(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"block";e.style.display=t},listener:function(e,t,s){document.addEventListener(e,(function(e){let n=document.body.querySelectorAll(t),l=e.target,o=-1;for(;l&&-1===(o=Array.prototype.indexOf.call(n,l));)l=l.parentElement;o>-1&&function(){"function"==typeof s&&s(l,e),e.preventDefault()}.call(l,e)}))},merge:function(){const e=this,t=e=>e&&"object"==typeof e;for(var s=arguments.length,n=new Array(s),l=0;l<s;l++)n[l]=arguments[l];return n.reduce(((s,n)=>(Object.keys(n).forEach((l=>{const o=s[l],r=n[l];Array.isArray(o)&&Array.isArray(r)?s[l]=o.concat(...r):t(o)&&t(r)?s[l]=e.merge(o,r):s[l]=r})),s)),{})},ajax:{x:function(){if("undefined"!=typeof XMLHttpRequest)return new XMLHttpRequest;let e,t=["MSXML2.XmlHttp.6.0","MSXML2.XmlHttp.5.0","MSXML2.XmlHttp.4.0","MSXML2.XmlHttp.3.0","MSXML2.XmlHttp.2.0","Microsoft.XmlHttp"];for(let s=0;s<t.length;s++)try{e=new ActiveXObject(t[s]);break}catch(e){}return e},send:function(e,s,n,l,o){void 0===o&&(o=!0);let r=t.ajax.x();r.open(n,e,o),r.onreadystatechange=function(){if(4===r.readyState)if(200===r.status)s("success",r.responseText);else s("error",r.responseText)},r.send(l)},get:function(e,s,n,l){let o=[];for(let e of s)o.push(encodeURIComponent(e[0])+"="+encodeURIComponent(e[1]));t.ajax.send(e+(o.length?"?"+o.join("&"):""),n,"GET",null,l)},post:function(e,s,n,l){t.ajax.send(e,n,"POST",s,l)}},getDataAttributes:function(e){let t={};return[].forEach.call(e.attributes,(function(e){if(/^data-/.test(e.name)){let s=e.name.substr(5).replace(/-(.)/g,(function(e,t){return t.toUpperCase()}));t[s]=e.value}})),t},isEmptyObj:function(e){for(let t in e)if(Object.prototype.hasOwnProperty.call(e,t))return!1;return!0},eventHandler:{on:function(e,t){const s=new CustomEvent(t,{bubbles:!0,detail:arguments.length>2&&void 0!==arguments[2]?arguments[2]:{}});e.dispatchEvent(s)}}};class s{constructor(e){let s=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};this.classes={container:"vg-select",dropdown:"vg-select-dropdown",list:"vg-select-list",option:"vg-select-list--option",optgroup:"vg-select-list--optgroup",optgroupTitle:"vg-select-list--optgroup-title",current:"vg-select-current",search:"vg-select-search"};const n={search:!1};return e?"SELECT"!==e.tagName?(console.error('Тэг должен быть "select"'),!1):(this.settings=function(e,s,n){let l=t.merge(s,n),o=[].filter.call(e.attributes,(function(e){return/^data-/.test(e.name)}));for(let e of o)"data-search"===e.name&&(l.search="false"!==e.value);return l}(e,n,s),this.create(e),void this.refresh(e)):(console.error("Первый параметр не должен быть пустым"),!1)}create(e){var s;let n=arguments.length>1&&void 0!==arguments[1]&&arguments[1];const l=this;if("true"===(null===(s=e.dataset)||void 0===s?void 0:s.inited)&&!n)return;l.destroy(e),e.parentElement.style.position="relative";let o=e.options[e.selectedIndex].innerText,r=e.options,c=e.getAttribute("class"),a=document.createElement("div");c=c.split(" ");for(const e of c)a.classList.add(e);e.hasAttribute("disabled")&&a.classList.add("disabled");let i=t.getDataAttributes(e);if(!t.isEmptyObj(i))for(const e of Object.keys(i))a.setAttribute("data-"+e,i[e]);let d=document.createElement("div");d.classList.add(l.classes.current),d.innerText=o.trim(),a.append(d);let u=document.createElement("div");u.classList.add(l.classes.dropdown),a.append(u);let p=document.createElement("ul");p.classList.add(l.classes.list);let f=e.querySelectorAll("optgroup");if(f.length){let e=!1;[...f].forEach((function(t){let s=document.createElement("ol");s.classList.add(l.classes.optgroup);let n=document.createElement("li");n.innerHTML=t.label.trim(),n.classList.add(l.classes.optgroupTitle),s.prepend(n),h(t.querySelectorAll("option"),s,e),p.append(s),e=!0}))}else{h(r,p,!1)}function h(s,n,o){let r=0;for(const c of s){let s=document.createElement("li");s.innerHTML=c.innerHTML.trim().replace(/<\/[^>]+(>|$)/g,""),s.dataset.value=c.getAttribute("value"),s.classList.add(l.classes.option);let a=t.getDataAttributes(c);if(!t.isEmptyObj(a))for(const e of Object.keys(a))s.setAttribute("data-"+e,a[e]);r!==e.selectedIndex||o||s.classList.add("selected"),c.hasAttribute("disabled")&&s.classList.add("disabled"),c.hasAttribute("hidden")&&s.classList.add("hidden"),n.append(s),r++}}u.append(p),e.insertAdjacentElement("afterend",a),e.dataset.inited=!0,l.settings.search&&this.search(a),l.toggle(a)}destroy(e){let t=e.nextElementSibling;t&&t.classList.contains("vg-select")&&(t.remove(),e.selectedIndex=0,[...e.querySelectorAll("option")].forEach((function(t,s){t.hasAttribute("selected")&&(e.selectedIndex=s)})))}toggle(e){const s=this;e.querySelector("."+s.classes.current).onclick=function(e){let t=e.target.closest(".vg-select"),n=document.querySelectorAll(".vg-select");if(n.length)for(const e of n)e!==t&&e.classList.remove("show");if(t.classList.contains("show"))t.classList.remove("show");else if(t.classList.add("show"),s.settings.search){let e=t.querySelector("input");e&&e.focus()}return!1},e.querySelectorAll("."+s.classes.option).forEach((e=>{e.addEventListener("click",(e=>{e.preventDefault();let n=e.target;if(!n.classList.contains("disabled")){let e=n.closest("."+s.classes.container),l=e.querySelectorAll("."+s.classes.option);if(l.length)for(const e of l)e.classList.remove("selected");n.classList.add("selected"),e.querySelector("."+s.classes.current).innerText=n.innerText,e.classList.remove("show");let o=e.previousSibling;o.value=n.dataset.value,t.eventHandler.on(o,"change")}}))})),window.addEventListener("click",(function(e){if(!e.target.closest(".vg-select")){let e=document.querySelectorAll(".vg-select");if(e.length)for(const t of e)t.classList.remove("show")}}))}refresh(e){const t=this;new MutationObserver((s=>{s.forEach((()=>{t.create(e,!0)}))})).observe(e,{childList:!0,subtree:!0,characterDataOldValue:!0})}static getCreate(e){return new this(e,{}).create(e,!0)}search(e){const s=this;let n=e.querySelector("."+s.classes.dropdown),l=document.createElement("div");l.classList.add(s.classes.search);let o=document.createElement("input");o.setAttribute("name","vg-select-search"),o.setAttribute("type","text"),o.setAttribute("placeholder","Поиск..."),l.append(o),n.prepend(l),l.querySelector("[name=vg-select-search]").addEventListener("keyup",(e=>{e.preventDefault();let n=e.target,l=n.closest("."+s.classes.dropdown).querySelector("."+s.classes.list);if(l){let e=[...l.querySelectorAll("."+s.classes.option)],o=[...l.querySelectorAll("."+s.classes.optgroup)],c=n.value;e=e.concat(o);for(const s of e)t.show(s);if(c.length){c=c.trim(),c=c.toLowerCase(),c=r(c,!0);for(const s of e){-1===s.innerText.toLowerCase().indexOf(c)&&t.hide(s)}}}}));const r=function(e,t){let s,n="й ц у к е н г ш щ з х ъ ф ы в а п р о л д ж э я ч с м и т ь б ю".split(/ +/g),l="q w e r t y u i o p [ ] a s d f g h j k l ; ' z x c v b n m , .".split(/ +/g);for(s=0;s<n.length;s++)e=(e=e.split(t?l[s]:n[s]).join(t?n[s]:l[s])).split(t?l[s].toUpperCase():n[s].toUpperCase()).join(t?n[s].toUpperCase():l[s].toUpperCase());return e}}}[...document.querySelectorAll("form")].forEach((function(e){e.addEventListener("reset",(function(){e.querySelectorAll("select.vg-select").forEach((function(e){s.getCreate(e)}))}))})),e.VGSelect=s}));
